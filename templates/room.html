{% extends 'base.html' %}
{% load static %}

{% block content %}


<div class="container">
    <!-- LOBBY SCREEN -->
    <div id="lobby-screen" class="fade-in-up">
        <div style="text-align: center; margin-bottom: 40px;">
            <h1 style="font-size: 3rem; margin-bottom: 10px;">üïµÔ∏è Kallanum Policum</h1>
            <div class="glass-card" style="display: inline-block; padding: 15px 30px; border-color: var(--primary-color);">
                <span style="color: var(--text-muted); text-transform: uppercase; letter-spacing: 2px; font-size: 0.9rem;">Room Code</span><br>
                <span style="color: var(--primary-color); font-weight: bold; font-size: 2.5rem; letter-spacing: 5px; font-family: 'Outfit', sans-serif;">{{ room.room_code }}</span>
            </div>
        </div>

        <!-- Connection Status -->
        <div id="connection-status" style="text-align: center; margin-bottom: 30px;">
            <span style="padding: 8px 20px; border-radius: 20px; background: rgba(0,0,0,0.5); color: #888; font-size: 0.9rem; border: 1px solid var(--glass-border);">
                üì° Connecting...
            </span>
        </div>

        {% if is_host %}
        <div style="text-align: center; margin-bottom: 40px; display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
            <button class="btn btn-primary" onclick="startGame()">‚ñ∂ Start Game</button>
            <button class="btn" onclick="openSettings()">‚öôÔ∏è Settings</button>
        </div>
        {% else %}
        <div class="glass-card" style="text-align: center; margin-bottom: 40px; color: var(--text-muted); font-style: italic;">
            <div style="font-size: 2rem; margin-bottom: 10px; animation: pulseGlow 2s infinite;">‚è≥</div>
            Waiting for host to start...
        </div>
        {% endif %}

        <div style="display: flex; align-items: center; margin-bottom: 20px;">
            <h3 style="margin: 0; color: var(--text-muted);">Players Joined</h3>
            <div style="flex: 1; height: 1px; background: var(--glass-border); margin-left: 20px;"></div>
        </div>
        
        <div id="player-list" class="player-grid">
            {% for p in room.players.all %}
            <div class="player-card fade-in-up">
                <img src="{% static 'images/icon_civilian.png' %}" class="player-avatar">
                <div style="font-weight: bold; font-size: 1.1rem;">{{ p.name }}</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- SETTINGS MODAL -->
    <div id="settings-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000; backdrop-filter: blur(10px);">
        <div class="glass-card fade-in-up" style="width: 90%; max-width: 500px; margin: 50px auto; border: 1px solid var(--primary-color); position: relative; display: flex; flex-direction: column; max-height: 90vh;">
            <button onclick="closeSettings()" style="position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: var(--text-muted);">‚úï</button>
            
            <h2 style="margin-bottom: 20px; color: var(--primary-color); text-align: center;">‚öôÔ∏è Game Settings</h2>
            
            <div style="flex: 1; overflow-y: auto; padding: 5px;">
                <div style="margin-bottom: 25px;">
                    <label style="display: block; margin-bottom: 10px; color: var(--text-muted); font-weight: 600;">Max Rounds</label>
                    <input type="number" id="setting-max-rounds" value="5" min="1" max="20" style="font-size: 1.2rem; font-weight: bold; text-align: center;">
                </div>
                
                <div style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 15px; color: var(--text-muted); font-weight: 600;">Role Points</label>
                    <div id="roles-settings-container">
                        <!-- Dynamic roles inputs will be here -->
                    </div>
                </div>
            </div>
            
            <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid var(--glass-border);">
                <button class="btn btn-primary" onclick="saveSettings()" style="width: 100%;">Save Changes</button>
            </div>
        </div>
    </div>

    <!-- CHIT SCREEN -->
    <div id="chit-screen" style="display: none; text-align: center;" class="fade-in-up">
        <h2 style="margin-bottom: 10px;">Your Secret Role</h2>
        <p style="color: var(--text-muted); margin-bottom: 30px;">Tap the card to reveal who you are...</p>
        
        <div class="card-container" onclick="revealRole()">
            <div id="chit-card" class="card">
                <div class="card-front">
                    <img src="{% static 'images/card_back.png' %}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 24px;">
                </div>
                <div class="card-back" id="chit-back">
                    <div id="role-icon-container" style="margin-bottom: 20px;"></div>
                    <h2 id="role-name" style="font-size: 2.5rem; margin-bottom: 10px; color: var(--primary-color);"></h2>
                    <div id="role-points" style="font-size: 1.2rem; color: var(--text-muted); border: 1px solid var(--glass-border); padding: 5px 15px; border-radius: 20px;"></div>
                </div>
            </div>
        </div>
        
        <div id="ready-btn" style="display: none; margin-top: 30px;" class="fade-in-up">
            <button class="btn btn-primary" onclick="readyToPlay()" style="width: 200px;">I'm Ready</button>
        </div>
    </div>

    <!-- POLICE SCREEN -->
    <div id="police-screen" style="display: none;" class="fade-in-up">
        <div class="glass-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-color: var(--primary-color);">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 2.5rem;">üëÆ</div>
                <div>
                    <h2 style="margin: 0; font-size: 1.5rem;">You are the Police</h2>
                    <span style="color: var(--text-muted); font-size: 0.9rem;">Find the thief!</span>
                </div>
            </div>
            <div id="timer-display" style="font-size: 2rem; font-weight: bold; color: var(--secondary-color); font-family: 'Outfit', monospace;">60s</div>
        </div>
        
        <h3 style="color: var(--text-muted); margin-bottom: 20px;">Suspects</h3>
        
        <div id="suspects-list" style="display: grid; gap: 15px;">
            <!-- Suspects will be listed here -->
        </div>
        
        <div class="glass-card" style="margin-top: 30px; border-color: var(--secondary-color); background: rgba(255, 71, 87, 0.1);">
            <p style="color: var(--secondary-color); font-weight: bold; margin: 0; text-align: center;">‚ö†Ô∏è Warning: Wrong arrest means the Thief wins!</p>
        </div>
    </div>

    <!-- NORMAL PLAYER VIEW -->
    <div id="player-screen" style="display: none;" class="fade-in-up">
        <div class="glass-card" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
            <div style="display: flex; align-items: center; gap: 15px;">
                <div style="font-size: 2.5rem;">üé≠</div>
                <div>
                    <h2 style="margin: 0; font-size: 1.5rem;">You are <span id="current-role" style="color: var(--primary-color);"></span></h2>
                    <span style="color: var(--text-muted); font-size: 0.9rem;">Stay hidden...</span>
                </div>
            </div>
            <div id="player-timer-display" style="font-size: 2rem; font-weight: bold; color: var(--secondary-color); font-family: 'Outfit', monospace;">60s</div>
        </div>
        
        <div class="glass-card" style="margin: 20px 0; text-align: center; padding: 40px;">
            <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 10px; font-weight: bold;">
                <span id="current-points"></span> <span style="font-size: 1.5rem; color: var(--text-muted);">pts</span>
            </div>
            <p id="role-desc" style="color: var(--text-muted); font-style: italic; margin-bottom: 20px; font-size: 1.1rem;"></p>
            
            <div style="display: inline-block; padding: 10px 20px; background: rgba(255,255,255,0.05); border-radius: 30px; margin-top: 20px;">
                <span style="animation: pulseGlow 2s infinite; display: inline-block;">üö®</span> Waiting for police action...
            </div>
        </div>
        
        <div style="margin-top: 40px;">
            <h3 style="font-size: 1.2rem; margin-bottom: 20px; color: var(--text-muted);">Other Players</h3>
            <div id="other-players-list" class="player-grid">
                <!-- Other players shown without roles -->
            </div>
        </div>
    </div>
    
    <!-- RESULT SCREEN -->
    <div id="result-screen" style="display: none; text-align: center;" class="fade-in-up">
        <div id="result-icon" style="font-size: 6rem; margin-bottom: 20px; animation: float 3s ease-in-out infinite;"></div>
        <h1 id="result-title" style="font-size: 3.5rem; margin-bottom: 10px;"></h1>
        <p id="result-message" style="font-size: 1.3rem; color: var(--text-muted); margin-bottom: 40px;"></p>
        
        <div class="glass-card" style="margin: 0 auto 40px auto; max-width: 600px;">
            <h3 style="border-bottom: 1px solid var(--glass-border); padding-bottom: 15px; margin-bottom: 15px;">Round Standings</h3>
            <table style="width: 100%; text-align: left; border-collapse: collapse;">
                <thead>
                    <tr style="color: var(--text-muted);">
                        <th style="padding: 15px;">Rank</th>
                        <th style="padding: 15px;">Player</th>
                        <th style="padding: 15px; text-align: right;">Score</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- Rows will be added here -->
                </tbody>
            </table>
        </div>
        
        {% if is_host %}
        <button class="btn btn-primary" onclick="nextRound()">‚ñ∂ Next Round</button>
        {% else %}
        <p style="color: var(--text-muted); font-style: italic;">Waiting for host...</p>
        {% endif %}
    </div>

    <!-- PODIUM SCREEN -->
    <div id="podium-screen" style="display: none; text-align: center;" class="fade-in-up">
        <h1 style="font-size: 4rem; margin-bottom: 40px; color: var(--primary-color);">üèÜ GAME OVER</h1>
        
        <div style="display: flex; justify-content: center; align-items: flex-end; height: 350px; margin-bottom: 50px; gap: 20px;">
            <!-- Silver -->
            <div style="width: 100px; text-align: center;" class="delay-2 fade-in-up">
                <div style="margin-bottom: 15px; font-weight: bold; font-size: 1.1rem;" id="silver-name"></div>
                <div style="height: 180px; background: linear-gradient(to top, #C0C0C0, #E0E0E0); border-radius: 15px 15px 0 0; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 15px; color: #333; font-weight: bold; box-shadow: 0 0 30px rgba(192,192,192,0.3);">
                    <div id="silver-score" style="font-size: 1.2rem;"></div>
                </div>
                <div style="font-size: 3rem; margin-top: 10px;">ü•à</div>
            </div>
            
            <!-- Gold -->
            <div style="width: 120px; text-align: center;" class="delay-1 fade-in-up">
                <div style="margin-bottom: 15px; font-weight: bold; font-size: 1.3rem; color: var(--primary-color);" id="gold-name"></div>
                <div style="height: 250px; background: linear-gradient(to top, #FFD700, #FFE55C); border-radius: 15px 15px 0 0; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 15px; color: #333; font-weight: bold; box-shadow: 0 0 50px rgba(255,215,0,0.4);">
                    <div id="gold-score" style="font-size: 1.5rem;"></div>
                </div>
                <div style="font-size: 4rem; margin-top: 10px;">ü•á</div>
            </div>
            
            <!-- Bronze -->
            <div style="width: 100px; text-align: center;" class="delay-3 fade-in-up">
                <div style="margin-bottom: 15px; font-weight: bold; font-size: 1.1rem;" id="bronze-name"></div>
                <div style="height: 120px; background: linear-gradient(to top, #CD7F32, #E69B5C); border-radius: 15px 15px 0 0; display: flex; align-items: flex-end; justify-content: center; padding-bottom: 15px; color: #333; font-weight: bold; box-shadow: 0 0 30px rgba(205,127,50,0.3);">
                    <div id="bronze-score" style="font-size: 1.2rem;"></div>
                </div>
                <div style="font-size: 3rem; margin-top: 10px;">ü•â</div>
            </div>
        </div>
        
        <div class="glass-card" style="margin: 20px auto; max-width: 600px;">
            <h3 style="border-bottom: 1px solid var(--glass-border); padding-bottom: 15px; margin-bottom: 15px;">Final Standings</h3>
            <div id="final-leaderboard"></div>
        </div>
        
        <button class="btn" onclick="location.href='/'" style="margin-top: 30px;">üè† Back to Home</button>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    const roomCode = "{{ room.room_code }}";
    const playerName = "{{ player.name }}";
    const sessionId = "{{ player.session_id }}";
    const isHost = {{ is_host|yesno:"true,false" }};

    let myRole = null;
    let myPoints = 0;
    let myDesc = "";
    let isPolice = false;
    let isThief = false;
    let allPlayers = [];
    let chitRevealed = false;

    // Debug info
    console.log('üéÆ Initializing game room');
    console.log('Room Code:', roomCode);
    const protocol = window.location.protocol === 'https:' ? 'wss://' : 'ws://';
    let chatSocket = null;

    function connectWebSocket() {
        console.log("üîå Connecting...");
        const status = document.getElementById('connection-status');
        if (status) status.innerHTML = '<span style="color: #f1c40f;">‚è≥ Connecting...</span>';

        chatSocket = new WebSocket(
            protocol + window.location.host + '/ws/room/' + roomCode + '/'
        );

        chatSocket.onopen = function(e) {
            console.log('‚úÖ Connected');
            if (status) status.innerHTML = '<span style="color: #2ed573;">‚úÖ Connected</span>';
            
            chatSocket.send(JSON.stringify({
                'action': 'join',
                'message': playerName + ' joined'
            }));
        };

        chatSocket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            
            if (data.action === 'player_update' || data.action === 'player_joined') {
                updatePlayerList(data.players);
            }
            else if (data.action === 'send_role_to_player') {
                if (data.target_session_id === sessionId) {
                    myRole = data.role;
                    myPoints = data.points;
                    myDesc = data.description;
                    isPolice = data.is_police;
                    isThief = data.is_thief;
                    if (data.all_players) allPlayers = data.all_players;
                    showChitScreen();
                }
            }
            else if (data.action === 'round_ended') {
                showResult(data);
            }
            else if (data.action === 'game_over') {
                showPodium(data.scores);
            }
            else if (data.action === 'timer_tick') {
                updateTimer(data.seconds);
            }
            else if (data.action === 'reset_round') {
                resetUI();
            }
            else if (data.action === 'host_change') {
                if (data.new_host_session_id === sessionId) {
                    alert("üëë You are now the Host!");
                    location.reload();
                }
            }
            else if (data.action === 'error') {
                alert("‚ö†Ô∏è Error: " + data.message);
            }
        };

        chatSocket.onclose = function(e) {
            console.log('‚ùå Disconnected. Retrying in 3s...');
            if (status) status.innerHTML = '<span style="color: #ff4757;">‚ùå Disconnected</span>';
            
            setTimeout(function() {
                connectWebSocket();
            }, 3000);
        };
        
        chatSocket.onerror = function(err) {
            console.error('Socket Error:', err);
            chatSocket.close();
        };
    }

    // Initial Connection
    connectWebSocket();

    function resetUI() {
        myRole = null;
        myPoints = 0;
        myDesc = "";
        isPolice = false;
        isThief = false;
        chitRevealed = false;
        
        // Reset Card
        const card = document.getElementById('chit-card');
        if(card) card.style.transform = 'rotateY(0deg)';
        
        // Hide all screens except Lobby
        document.getElementById('chit-screen').style.display = 'none';
        document.getElementById('police-screen').style.display = 'none';
        document.getElementById('player-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('podium-screen').style.display = 'none';
        
        // Show Lobby
        document.getElementById('lobby-screen').style.display = 'block';
        
        // Update status text
        const statusDiv = document.querySelector('#lobby-screen .glass-card');
        if(statusDiv) statusDiv.innerHTML = '<div style="font-size: 2rem; margin-bottom: 10px; animation: pulseGlow 2s infinite;">‚è≥</div> Starting next round...';
    }

    function startGame() {
        console.log('üéÆ Host starting game...');
        chatSocket.send(JSON.stringify({
            'action': 'start_game',
            'message': 'Host started the game'
        }));
    }

    function openSettings() {
        document.getElementById('settings-modal').style.display = 'block';
        document.getElementById('roles-settings-container').innerHTML = '<p style="color: #888;">Loading roles...</p>';
        
        // Request current settings
        chatSocket.send(JSON.stringify({
            'action': 'get_settings'
        }));
    }

    function closeSettings() {
        document.getElementById('settings-modal').style.display = 'none';
    }

    function populateSettingsModal(settings) {
        document.getElementById('setting-max-rounds').value = settings.max_rounds;
        
        const container = document.getElementById('roles-settings-container');
        container.innerHTML = '';
        
        settings.roles.forEach(role => {
            container.innerHTML += `
                <div class="role-setting-item" data-id="${role.id}" style="background: rgba(0,0,0,0.3); padding: 15px; margin-bottom: 10px; border-radius: 12px; display: flex; gap: 15px; align-items: center; border: 1px solid var(--glass-border);">
                    <input type="text" class="role-name-input" value="${role.name}" style="flex: 1;">
                    <input type="number" class="role-points-input" value="${role.win_points}" style="width: 80px;">
                    <span style="font-size: 0.9rem; color: var(--text-muted);">pts</span>
                </div>
            `;
        });
    }

    function saveSettings() {
        const maxRounds = document.getElementById('setting-max-rounds').value;
        const roleItems = document.querySelectorAll('.role-setting-item');
        const rolesData = [];
        
        roleItems.forEach(item => {
            rolesData.push({
                'id': item.getAttribute('data-id'),
                'name': item.querySelector('.role-name-input').value,
                'win_points': item.querySelector('.role-points-input').value
            });
        });
        
        chatSocket.send(JSON.stringify({
            'action': 'update_settings',
            'max_rounds': maxRounds,
            'roles': rolesData
        }));
    }

    function updatePlayerList(players) {
        const list = document.getElementById('player-list');
        list.innerHTML = '';
        players.forEach(p => {
            list.innerHTML += `
                <div class="player-card fade-in-up">
                    <img src="{% static 'images/icon_civilian.png' %}" class="player-avatar">
                    <div style="font-weight: bold; font-size: 1.1rem;">${p.name}</div>
                </div>
            `;
        });
    }

    function showChitScreen() {
        document.getElementById('lobby-screen').style.display = 'none';
        document.getElementById('chit-screen').style.display = 'block';
        
        // Set role info on the back of the card
        let iconSrc = "{% static 'images/icon_civilian.png' %}";
        if (isPolice) iconSrc = "{% static 'images/icon_police.png' %}";
        else if (isThief) iconSrc = "{% static 'images/icon_thief.png' %}";
        
        document.getElementById('role-icon-container').innerHTML = `<img src="${iconSrc}" style="width: 100px; height: 100px; filter: drop-shadow(0 0 10px rgba(255,215,0,0.3));">`;
        document.getElementById('role-name').textContent = myRole;
        document.getElementById('role-points').textContent = myPoints + ' Points';
        
        // Reset card flip
        const card = document.getElementById('chit-card');
        card.style.transform = 'rotateY(0deg)';
        chitRevealed = false;
        document.getElementById('ready-btn').style.display = 'none';
    }

    function revealRole() {
        if (chitRevealed) return;
        
        const card = document.getElementById('chit-card');
        card.style.transform = 'rotateY(180deg)';
        chitRevealed = true;
        
        setTimeout(() => {
            document.getElementById('ready-btn').style.display = 'block';
        }, 600);
    }

    function readyToPlay() {
        document.getElementById('chit-screen').style.display = 'none';
        
        if (isPolice) {
            showPoliceScreen();
        } else {
            showPlayerScreen();
        }
    }

    function showPoliceScreen() {
        document.getElementById('police-screen').style.display = 'block';
        
        const suspectsList = document.getElementById('suspects-list');
        suspectsList.innerHTML = '';
        
        allPlayers.forEach(p => {
            if (p.name !== playerName) {
                suspectsList.innerHTML += `
                    <div class="glass-card fade-in-up" style="margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; padding: 20px;">
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span style="font-size: 2rem;">üë§</span>
                            <span style="font-size: 1.3rem; font-weight: bold;">${p.name}</span>
                        </div>
                        <button class="btn btn-danger" onclick="arrestPlayer('${p.name}')" style="width: auto; padding: 10px 25px; margin: 0; font-size: 0.9rem;">
                            üö® ARREST
                        </button>
                    </div>
                `;
            }
        });
    }

    function showPlayerScreen() {
        document.getElementById('player-screen').style.display = 'block';
        document.getElementById('current-role').textContent = myRole;
        document.getElementById('current-points').textContent = myPoints;
        document.getElementById('role-desc').textContent = myDesc;
        
        const otherPlayersList = document.getElementById('other-players-list');
        otherPlayersList.innerHTML = '';
        
        allPlayers.forEach(p => {
            if (p.name !== playerName) {
                otherPlayersList.innerHTML += `
                    <div class="player-card fade-in-up">
                        <div style="font-size: 2.5rem; margin-bottom: 10px;">üë§</div>
                        <div style="font-size: 1rem;">${p.name}</div>
                    </div>
                `;
            }
        });
    }

    function arrestPlayer(name) {
        console.log('üö® Button Clicked! Attempting to arrest:', name);
        console.log('Session ID:', sessionId);
        
        if (confirm(`Are you sure you want to arrest ${name}?`)) {
            const arrestMessage = {
                'action': 'arrest',
                'session_id': sessionId,
                'arrested_player': name
            };
            console.log('üì§ Sending arrest message:', arrestMessage);
            chatSocket.send(JSON.stringify(arrestMessage));
        }
    }
    
    function updateTimer(seconds) {
        const display = document.getElementById('timer-display');
        const pDisplay = document.getElementById('player-timer-display');
        if (display) display.textContent = seconds + 's';
        if (pDisplay) pDisplay.textContent = seconds + 's';
        
        if (seconds <= 10) {
            if (display) display.style.color = '#ff4757';
            if (display) display.style.textShadow = '0 0 10px #ff4757';
            if (pDisplay) pDisplay.style.color = '#ff4757';
            if (pDisplay) pDisplay.style.textShadow = '0 0 10px #ff4757';
        }
    }

    function showResult(winner, thiefName, scores) {
        document.getElementById('police-screen').style.display = 'none';
        document.getElementById('player-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'block';
        
        const icon = document.getElementById('result-icon');
        const title = document.getElementById('result-title');
        const message = document.getElementById('result-message');
        
        if (winner === 'POLICE') {
            icon.textContent = 'üëÆ';
            title.textContent = 'Police Wins!';
            title.style.color = 'var(--primary-color)';
            message.innerHTML = `The thief <span style="color: var(--secondary-color); font-weight: bold; font-size: 1.5rem;">${thiefName}</span> was caught!`;
        } else {
            icon.textContent = 'üé≠';
            title.textContent = 'Thief Escapes!';
            title.style.color = 'var(--secondary-color)';
            message.innerHTML = `<span style="color: var(--secondary-color); font-weight: bold; font-size: 1.5rem;">${thiefName}</span> was the thief and got away!`;
        }
        
        const leaderboardBody = document.getElementById('leaderboard-body');
        leaderboardBody.innerHTML = '';
        scores.forEach((s, i) => {
            const medal = i === 0 ? 'ü•á' : i === 1 ? 'ü•à' : i === 2 ? 'ü•â' : '';
            leaderboardBody.innerHTML += `
                <tr style="border-bottom: 1px solid var(--glass-border);">
                    <td style="padding: 15px;">${medal} ${i+1}</td>
                    <td style="padding: 15px;">${s.name}</td>
                    <td style="padding: 15px; text-align: right; color: var(--primary-color); font-weight: bold;">${s.score}</td>
                </tr>
            `;
        });
    }

    function nextRound() {
        // Send request to server to reset everyone
        chatSocket.send(JSON.stringify({
            'action': 'next_round'
        }));
    }

    function showPodium(scores) {
        // Hide all other screens
        document.getElementById('lobby-screen').style.display = 'none';
        document.getElementById('chit-screen').style.display = 'none';
        document.getElementById('police-screen').style.display = 'none';
        document.getElementById('player-screen').style.display = 'none';
        document.getElementById('result-screen').style.display = 'none';
        document.getElementById('podium-screen').style.display = 'block';
        
        // Gold
        if (scores[0]) {
            const goldName = document.getElementById('gold-name');
            const goldScore = document.getElementById('gold-score');
            if (goldName) goldName.textContent = scores[0].name;
            if (goldScore) goldScore.textContent = scores[0].score;
        }
        
        // Silver
        if (scores[1]) {
            const silverName = document.getElementById('silver-name');
            const silverScore = document.getElementById('silver-score');
            if (silverName) silverName.textContent = scores[1].name;
            if (silverScore) silverScore.textContent = scores[1].score;
        }
        
        // Bronze
        if (scores[2]) {
            const bronzeName = document.getElementById('bronze-name');
            const bronzeScore = document.getElementById('bronze-score');
            if (bronzeName) bronzeName.textContent = scores[2].name;
            if (bronzeScore) bronzeScore.textContent = scores[2].score;
        }
        
        // List
        const list = document.getElementById('final-leaderboard');
        list.innerHTML = '';
        scores.forEach((s, i) => {
            if (i > 2) {
                list.innerHTML += `
                    <div style="display: flex; justify-content: space-between; padding: 15px; border-bottom: 1px solid var(--glass-border);">
                        <span>#${i+1} ${s.name}</span>
                        <span style="color: var(--primary-color); font-weight: bold;">${s.score}</span>
                    </div>
                `;
            }
        });
    }
</script>
{% endblock %}
